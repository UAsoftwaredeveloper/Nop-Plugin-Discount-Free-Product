@model ProductOverviewModel
@using Nop.Core
@using Nop.Core.Domain.Catalog
@using Nop.Core.Domain.Orders
@using Nop.Core.Domain.Tax
@inject CatalogSettings catalogSettings
@inject IWorkContext workContext
@inject Nop.Services.Helpers.IUserAgentHelper userAgent
@inject Nop.Services.Catalog.IProductService _productService
@{
    //prepare "Add to cart" AJAX link
    var addtocartlink = "";
    var shoppingCartTypeId = (int)ShoppingCartType.ShoppingCart;
    var quantity = 1;
    if (Model.ProductPrice.ForceRedirectionAfterAddingToCart)
    {
        addtocartlink = Url.RouteUrl("AddProductToCart-Catalog", new { productId = Model.Id, shoppingCartTypeId = shoppingCartTypeId, quantity = quantity, forceredirection = Model.ProductPrice.ForceRedirectionAfterAddingToCart });
    }
    else
    {
        addtocartlink = Url.RouteUrl("AddProductToCart-Catalog", new { productId = Model.Id, shoppingCartTypeId = shoppingCartTypeId, quantity = quantity });
    }
    var product = _productService.GetProductByIdAsync(Model.Id).Result;
    var addtowishlistlink = Url.RouteUrl("AddProductToCart-Catalog", new { productId = Model.Id, shoppingCartTypeId = (int)ShoppingCartType.Wishlist, quantity = quantity });
    var addtocomparelink = Url.RouteUrl("AddProductToCompare", new { productId = Model.Id });
}
@{
    string removeDRupeesymbol = !string.IsNullOrEmpty(Model.ProductPrice.OldPrice) ? Model.ProductPrice.OldPrice.Replace('₹', ' ') : Model.ProductPrice.PriceValue > 0 ? Model.ProductPrice.PriceValue.ToString() : string.Empty;
    decimal Mrp = !string.IsNullOrEmpty(removeDRupeesymbol) ? Convert.ToDecimal(removeDRupeesymbol) : 0;
    decimal DiscountValue = Mrp > 0 ? Mrp - Model.ProductPrice.PriceValue : 0;
    double disc = Convert.ToDouble((DiscountValue * 100) / Mrp);
}
@if (userAgent.IsMobileDevice())
{
    <div class="card product-card flash-sale-card">
        <div class="card-body" style="text-align:center">
            @if (product.StockQuantity > 0)
            {
                <span class="badge rounded-pill" style="background-color:#ed1890; color:#fff;">@(product.StockQuantity)</span>

            }
            else if (disc > 0)
            {
                <span class="badge rounded-pill" style="background-color:#ed1890; color:#fff;">@Math.Round(disc)%</span>
            }
            @if (!Model.ProductPrice.DisableWishlistButton)
            {
                <a href="javascript:void(0);" class="btn-product-icon wishlist-btn" title="@T("ShoppingCart.AddToWishlist")" onclick="AjaxCart.addproducttocart_catalog('@addtowishlistlink');return false;">
                    <i class="lni lni-heart"> </i>
                </a>
            }
            <a href="@Url.RouteUrl("Product", new { SeName = Model.SeName })" title="@Model.DefaultPictureModel.Title">
                <img alt="@Model.DefaultPictureModel.AlternateText" src="@Model.DefaultPictureModel.ImageUrl" title="@Model.DefaultPictureModel.Title" />
            </a>
            <span class="product-title">@Model.Name )</span>
            <p class="sale-price">&#8377; @Model.ProductPrice.PriceValue.ToString("0.00")<span class="real-price">@Model.ProductPrice.OldPrice</span></p>
            <div class="product-rating" style="font-size:12px;">
                @Model.ReviewOverviewModel.RatingSum
                <i class="lni lni-star-filled"></i>

            </div>
            @if (!Model.ProductPrice.DisableBuyButton)
            {
                <a class="btn btn-success btn-sm" href="javascript:void(0);" onclick="AjaxCart.addproducttocart_catalog('@addtocartlink');return false;"><i class="fa fa-cart-plus"></i> Add To Cart</a>
            }
        </div>
    </div>
}
else
{

    <div class="product product-slideup-content text-center">

        <figure class="picture" style="margin:0px">

            <a href="@Url.RouteUrl("Product", new { SeName = Model.SeName })" title="@Model.DefaultPictureModel.Title">
                <img alt="@Model.DefaultPictureModel.AlternateText" src="@Model.DefaultPictureModel.ImageUrl" title="@Model.DefaultPictureModel.Title" />
            </a>
            @if (disc > 0)
            {<div class="product-label-group"><label class="product-label label-sale">@Math.Round(disc)%</label></div>
        }
        </figure>

        <div class="product-details">

            <!--<div class="product-cat"><a href="#">Women’s</a></div>-->

            <h3 class="product-name"><a href="@Url.RouteUrl("Product", new {SeName = Model.SeName})">@Model.Name</a></h3>

            <div class="product-price">

                <ins class="new-price">@Model.ProductPrice.Price</ins>

                <del class="old-price">@Model.ProductPrice.OldPrice</del>

            </div>

        </div>

        <div class="product-hide-details">
            @if (Model.ReviewOverviewModel.AllowCustomerReviews)
            {
                var ratingPercent = 0;
                if (Model.ReviewOverviewModel.TotalReviews != 0)
                {
                    ratingPercent = ((Model.ReviewOverviewModel.RatingSum * 100) / Model.ReviewOverviewModel.TotalReviews) / 5;
                }
                <div class="ratings-container">

                    <div class="ratings-full">

                        <span class="ratings" style="width:@(ratingPercent + "%")"></span>

                        <span class="tooltiptext tooltip-top"></span>

                    </div>

                    <a href="javascript:void(0);" class="rating-reviews">( @Model.ReviewOverviewModel.TotalReviews reviews )</a>

                </div>
            }
            <div class="product-action">
                @if (!Model.ProductPrice.DisableAddToCompareListButton)
                {
                    <a href="javascript:void(0);" class="button-2 add-to-compare-list-button" title="@T("ShoppingCart.AddToCompareList")" onclick="AjaxCart.addproducttocomparelist('@addtocomparelink');return false;">@T("ShoppingCart.AddToCompareList")</a>
                }
                @if (!Model.ProductPrice.DisableWishlistButton)
                {
                    <a href="javascript:void(0);" class="btn-product-icon btn-wishlist" title="@T("ShoppingCart.AddToWishlist")" onclick="AjaxCart.addproducttocart_catalog('@addtowishlistlink');return false;">
                        <i class="d-icon-heart"></i>
                    </a>
                }
                @if (!Model.ProductPrice.DisableBuyButton)
                {
                    var addToCartText = T("ShoppingCart.AddToCart").Text;
                    if (Model.ProductPrice.IsRental)
                    {
                        addToCartText = T("ShoppingCart.Rent").Text;
                    }
                    if (Model.ProductPrice.AvailableForPreOrder)
                    {
                        addToCartText = T("ShoppingCart.PreOrder").Text;
                    }
                    <a href="javascript:void(0);" class="btn-product btn-cart" onclick="AjaxCart.addproducttocart_catalog('@addtocartlink');return false;">
                        <i class="d-icon-bag"></i><span>@(addToCartText)</span>
                    </a>
                }


            </div>

        </div>

    </div>
}